!function(a){function f(a){a+="";var b=a[0].toUpperCase();return b+a.substr(1)}function g(c,d){var h,e=this,f=a.extend(!0,{},g.defaultSettings,d);for(index=0;index<a(c).length;index++)if(void 0!==(h=a(c).data(b))){if(!f.autoReassign)return!1;h.remove(a(c))}this.$elements=a(c),this.settings=f,this._init(),this.$elements.each(function(){a(this).data(b,e)})}var b="__apifs__",c="apifs-",d="apifs",e="apifs";String.prototype.ucfirst||(String.prototype.ucfirst=function(){return f(this)}),jQuery.fn.tagName=function(){return this.prop("tagName").toLowerCase()},g.prototype={_init:function(){this.currentIndex=-1,this.opened=!1,this.usePseudeoFullscreenFallback=!1,this._addContainer(),this._obtainAndAppendImages(),this._addButtons(),this._bind(),this.settings.autoOpen&&this.open()},_addContainer:function(){this.$container=a(g.template).appendTo(a("body")),this.$fullscreenElement=this.$container.find("."+c+"fullscreen-element").attr("tabIndex",-1),this.$wrapper=this.$container.find("."+c+"wrapper"),this.$images=this.$container.find("."+c+"images")},_removeContainer:function(){this.$container.remove()},_obtainAndAppendImages:function(){var c,d,e,b=this;this.$elements.each(function(){void 0!==(c=b._obtainImageUrl(this))&&void 0!==(d=b._addImage(c))&&(void 0!==(e=a(this).data("background-color"))&&d.css("background-color",e),(b.settings.lazyLoad===!1||"instant"==b.settings.lazyLoad)&&b._loadImages(d))})},_obtainImageUrl:function(b){switch(a(b).tagName()){case"img":return a(b).attr("src");case"a":return a(b).attr("href")}return void 0},_addImage:function(b,c){var d="string"==typeof b?b:this._obtainImageUrl(b);if(d){var e=a("<li></li>").data({imageUrl:d,loaded:!1}),f=this._getItemCount();return f>0&&"number"==typeof c?(c=Math.min(Math.max(0,parseInt(c)),f-1),this._getItem(c).before(e)):this.$images.append(e),e}return void 0},_loadImages:function(b){var c=this;b.each(function(){if(a(this).data("loaded")===!1){var b=a.extend({imageUrl:a(this).data("imageUrl"),onSwipeRight:function(){c.settings.enableSwipe&&c.previous()},onSwipeLeft:function(){c.settings.enableSwipe&&c.next()}},c.settings.imageZoom);a(this).data("loaded",!0).apImageZoom(b)}})},_addButtons:function(){this._addButtonContainers();var b=["previous","next","close","download"];for(index in b){var e,d=b[index];if("object"==typeof this.settings.buttons&&void 0!=(e=this.settings.buttons[d])){var f=e.position.split(",").map(function(a){return a.trim().toLowerCase()});if(["left","right"].indexOf(f[0])>-1&&["top","center","bottom"].indexOf(f[1])>-1){var g=a("<a></a>").html(d.ucfirst()).attr("href","#"+d).addClass(c+"button").addClass(c+d+"-button");"string"==typeof e.text&&g.attr("alt",e.text).attr("title",e.text);var h="."+c+"buttons-"+f[0]+"-"+f[1];this.$wrapper.find(h).append(g),this["$"+d+"Button"]=g,g.data("clickMethodName",d),e.visible===!1&&g.hide();var i="string"==typeof e.theme?e.theme:this.settings.defaultTheme;g.addClass(c+"button-theme-"+i)}}}this._updateButtons()},_addButtonContainers:function(){var b=["left","right"],d=["top","center","bottom"];for(hIndex in b)for(vIndex in d)a("<div></div>").addClass(c+"buttons").addClass(c+"buttons-"+b[hIndex]+"-"+d[vIndex]).appendTo(this.$wrapper)},_updateButtons:function(){var a=c+"button-disabled";0==this.currentIndex?this.$previousButton.addClass(a):this.$previousButton.hasClass(a)&&this.$previousButton.removeClass(a),this.currentIndex==this._getItemCount()-1?this.$nextButton.addClass(a):this.$nextButton.hasClass(a)&&this.$nextButton.removeClass(a)},_bind:function(){var b=this,e=["previous","next","close","download"];for(index in e){var f=this["$"+e[index]+"Button"];f.on("click."+d,function(){if(!a(this).hasClass(c+"button-disabled")){var d=b[a(this).data("clickMethodName")];"function"==typeof d&&d.apply(b)}return!1})}var g={9:"tab","9+s":"shiftTab",27:"escape",32:"space",33:"pageUp",34:"pageDown",35:"end",36:"pos1",37:"left",38:"up",39:"right",40:"down"};this.$fullscreenElement.on("keydown."+d,function(a){if(8==a.keyCode&&b.opened)b.close();else if(a.keyCode>=48&&a.keyCode<=57&&b.settings.shortcuts.paging){var c=a.keyCode-48;"first"!=b.settings.shortcuts.zeroHandling&&(c--,"tenth"==b.settings.shortcuts.zeroHandling&&-1==c&&(c=9)),c>=0&&c<b._getItemCount()&&b._show(c,!0),a.preventDefault()}else{var e,d=a.keyCode+(a.shiftKey?"+s":"");if(d in b.settings.shortcuts)e=b.settings.shortcuts[d];else if(d in g){var f=g[d];e=b.settings.shortcuts[f]}e&&b._handleKeyAction(e,a)&&a.preventDefault()}})},_handleKeyAction:function(a,b){if("function"==typeof a){var c=this._getCurrentItem();a.apply(c,b)}else switch(a){case"zoomIn":return this._getCurrentItem().apImageZoom("zoomIn"),!0;case"zoomOut":return this._getCurrentItem().apImageZoom("zoomOut"),!0;case"zoomToggle":return this._getCurrentItem().apImageZoom("zoomToggle"),!0;case"next":return this.next(),!0;case"previous":return this.previous(),!0;case"first":return this.first(),!0;case"last":return this.last(),!0;case"close":return this.close(),!0}return!1},_unbind:function(){var a=["previous","next","close","download"];for(index in a){var b=this["$"+a[index]+"Button"];b.off("click."+d)}this.$fullscreenElement.off("keydown."+d)},_show:function(a,b){var c=this;if(a=Math.min(Math.max(a,0),this._getItemCount()-1),this.currentIndex!=a){this.currentIndex=a;var d=this._getItem(a),e=function(){"visible"==c.settings.lazyLoad&&c._loadImages(d)};this.settings.resetOnScroll&&this._resetItems(d);var f=100*-1*a+"%";b===!0?this.$images.stop(!0,!1).animate({left:f},this.settings.slideDuration,e):(this.$images.css("left",f),e()),this.$fullscreenElement.focus(),this._updateButtons()}},_getItem:function(a){var b=this.$images.children(":eq("+a+")");return b},_getCurrentItem:function(){var a=this._getItem(this.currentIndex);return a},_getAllItems:function(){var a=this.$images.children();return a},_getItemCount:function(){var a=this.$images.children().length;return a},_resetItems:function(b){var c=this;void 0==b?b=this._getAllItems():"number"==typeof b&&(b=this._getItem(b)),b.each(function(){a(this).data("loaded")===!0&&(a(this).apImageZoom("reset"),c._trigger("reset",[a(this)]))})},_trigger:function(a,b,c){var d="on"+a.ucfirst(),f=this.settings[d];"function"==typeof f&&(c=c?c:this._getCurrentItem(),f.apply(c,b)),a=e+a.ucfirst(),this._getCurrentItem().trigger(a,b)},_triggerHandler:function(a,b,c){var h,d="on"+a.ucfirst(),f=this.settings[d],g=void 0;return c=c?c:this._getCurrentItem(),"function"==typeof f&&(g=f.apply(c,b)),a=e+a.ucfirst(),h=void 0!==(h=c.triggerHandler(a,b))?h:g},open:function(b){this.opened||0==this._getItemCount()||(this.opened=!0,this.settings.lazyLoad!==!1&&"instant"!=this.settings.lazyLoad&&"visible"!==this.settings.lazyLoad&&this._loadImages(this._getAllItems()),this.settings.enableScreenfull&&"object"==typeof screenfull&&screenfull.enabled?(screenfull.request(this.$fullscreenElement[0]),a("html").removeClass(c+"pseudo-fullscreen").addClass(c+"screenfull"),this._validateVisibleFullscreen()):a("html").removeClass(c+"screenfull").addClass(c+"pseudo-fullscreen"),this.settings.resetOnOpen&&this._resetItems(),b||(b=this.currentIndex>-1?this.currentIndex:0),this._show(b,!1))},_validateVisibleFullscreen:function(){var b=this;setTimeout(function(){b.$fullscreenElement.is(":visible")||(b.opened=!1,a("html").removeClass(c+"screenfull"),b._triggerHandler("pseudoFullscreenFallback")!==!1&&(b.opened=!0,b.usePseudeoFullscreenFallback=!0,a("html").addClass(c+"pseudo-fullscreen")))},this.settings.fullscreenVisibleCheckDuration)},close:function(){this.opened&&(this.opened=!1,a("html").hasClass(c+"screenfull")?(screenfull.exit(),a("html").removeClass(c+"screenfull")):a("html").removeClass(c+"pseudo-fullscreen"))},isOpen:function(){return this.opened},next:function(){this.currentIndex<this._getItemCount()-1&&this._show(this.currentIndex+1,this.opened)},previous:function(){this.currentIndex>0&&this._show(this.currentIndex-1,this.opened)},first:function(){this._show(0,this.opened)},last:function(){this._show(this._getItemCount()-1,this.opened)},add:function(){this._trigger("add")},remove:function(){this._trigger("remove")},download:function(){var a=this._getCurrentItem().find("img").attr("src");window.open(a),this._trigger("download")},option:function(b,c){if(!b)return a.extend({},this.settings);var d;if("string"==typeof b){if(1===arguments.length)return void 0!==this.settings[b]?this.settings[b]:null;d={},d[b]=c}else d=b;this._setOptions(d)},_setOptions:function(a){for(key in a){var b=a[key];this.settings[key]=b}},destroy:function(){this._trigger("destroy"),this.opened&&this.close(),this._unbind(),this._removeContainer(),this.$elements.each(function(){a(this).removeData(b)})},_log:function(b){this.$log||(this.$log=a("<div></div>").addClass(c+"log").appendTo(a("body"))),this.$log.append(a("<p></p>").html(b))}},a.fn.apImageFullscreen=function(c){if("string"==typeof c){var d,e,h=[],i=Array.prototype.slice.call(arguments,1);return this.each(function(){if(d=a(this).data(b)){if("function"==typeof(e=d[c])&&"_"!==c.charAt(0)){var f=e.apply(d,i);void 0!==f&&h.push(f)}}else h.push(void 0)}),h.length?1===h.length?h[0]:h:this}var d=new g(this,c);return d?this:!1},g.defaultSettings={autoReassign:!0,autoOpen:!1,imageZoom:{minZoom:"contain",maxZoom:1,loadingAnimation:"throbber",loadingAnimationFadeOutDuration:500,doubleTap:"zoomToggle"},lazyLoad:"visible",slideDuration:250,resetOnOpen:!0,resetOnScroll:!0,defaultTheme:"dark",buttons:{close:{visible:!0,position:"right, top",text:"Close",theme:void 0},next:{visible:!0,position:"right, bottom",text:"Next",theme:void 0},previous:{visible:!0,position:"right, bottom",text:"Previous",theme:void 0},download:{visible:!0,position:"left, bottom",text:"Download",theme:void 0}},shortcuts:{escape:"close",space:"zoomToggle",tab:"next",shiftTab:"previous",up:"zoomIn",right:"next",down:"zoomOut",left:"previous",pageDown:"next",pageUp:"previous",pos1:"first",end:"last",paging:!0,zeroHandling:"first"},enableScreenfull:!0,fullscreenVisibleCheckDuration:20,enableSwipe:!0},g.template='<div class="'+c+'container">'+'<div class="'+c+'fullscreen-element">'+'<div class="'+c+"wrapper "+c+'clearfix">'+'<ul class="'+c+'images">'+"</ul>"+"</div>"+"</div>"+"</div>"}(jQuery);